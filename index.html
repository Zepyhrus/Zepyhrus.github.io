<!DOCTYPE html>





<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    save_scroll: false,
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  <link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Hexo</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  <div class="container sidebar-position-left">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
  </ul>

    

</nav>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content page-home">
            
  <section id="posts" class="posts-expand">
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/15/CPP-Primer-Chapter-6-Functions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zepyhrus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2020/01/15/CPP-Primer-Chapter-6-Functions/" class="post-title-link" itemprop="url">CPP-Primer-Chapter-6-Functions</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2020-01-15 19:32:46" itemprop="dateCreated datePublished" datetime="2020-01-15T19:32:46+08:00">2020-01-15</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-17 12:12:52" itemprop="dateModified" datetime="2020-01-17T12:12:52+08:00">2020-01-17</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="Chapter-6-函数"><a href="#Chapter-6-函数" class="headerlink" title="Chapter 6 函数"></a>Chapter 6 函数</h1><h2 id="6-1-函数基础"><a href="#6-1-函数基础" class="headerlink" title="6.1 函数基础"></a>6.1 函数基础</h2><h3 id="6-1-1-局部变量"><a href="#6-1-1-局部变量" class="headerlink" title="6.1.1 局部变量"></a>6.1.1 局部变量</h3><p><strong>自动对象</strong>： 只存在于块执行期间的对象称为<strong>自动对象</strong>(automatic object)。<strong>形参</strong> 是一种自动对象。函数开始时为形参申请存储空间，因为形参定义在函数体作用域之内，所以一旦函数终止，形参也就被销毁。</p>
<p><strong>局部静态对象</strong>： 局部静态对象(local static object)在程序执行路经第一次经过对象语句时初始化，并且直到程序终止才被销毁。</p>
<h3 id="6-1-2-函数声明"><a href="#6-1-2-函数声明" class="headerlink" title="6.1.2 函数声明"></a>6.1.2 函数声明</h3><p>如果一个函数永远不会被用到，那么它可以只有声明没有定义。函数声明无须函数体，用一个分号代替即可。</p>
<p>同时函数的声明不包含函数体，所以也就无须形参的名字。</p>
<p>函数三要素（返回类型、函数名、形参类型）描述了函数接口，说明了调用该函数所需的全部信息。函数声明也称作<strong>函数原型</strong>(function prototype)。</p>
<h3 id="6-1-3-分离式编译"><a href="#6-1-3-分离式编译" class="headerlink" title="6.1.3 分离式编译"></a>6.1.3 分离式编译</h3><p>请参见CMake的使用教程。</p>
<h2 id="6-2-参数传递"><a href="#6-2-参数传递" class="headerlink" title="6.2 参数传递"></a>6.2 参数传递</h2><p><strong>NOTES</strong>：每次调用函数时都会重新创建它的形参，并用传入的实参对形参进行初始化。形参初始化的机理与变量初始化一样。</p>
<p>当形参是引用类型时，我们说它对应的实参被<strong>引用传递</strong>，或者函数被<strong>引用调用</strong>。</p>
<p>当形参是被拷贝给形参时，形参和实参是两个相互独立的对象。这样的实参被<strong>值传递</strong>或者函数被<strong>传值调用</strong>。</p>
<p><strong>指针形参</strong>：指针的行为和其他非引用类型一样，拷贝的是指针的值。拷贝之后，两个指针是不同的指针，指向同一对象，通过指针可以修改它所指对象的值。</p>
<p>在C++中，建议使用引用类型的形参代替指针。</p>

          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/25/Detectron2-Code-Notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zepyhrus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/11/25/Detectron2-Code-Notes/" class="post-title-link" itemprop="url">Detectron2: Code Notes</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-11-25 10:55:31" itemprop="dateCreated datePublished" datetime="2019-11-25T10:55:31+08:00">2019-11-25</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-03 17:48:26" itemprop="dateModified" datetime="2020-01-03T17:48:26+08:00">2020-01-03</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p><strong>Detectron 2 源码阅读笔记</strong></p>
<p>Most part of the begining of this notes is inherited from <a href="https://www.cnblogs.com/marsggbo/p/11677086.html" target="_blank" rel="noopener">https://www.cnblogs.com/marsggbo/p/11677086.html</a>. </p>
<h1 id="1-代码结构概览"><a href="#1-代码结构概览" class="headerlink" title="1. 代码结构概览"></a>1. 代码结构概览</h1><ol>
<li><p>核心部分</p>
<ul>
<li>configs: 储存各种网络的yaml配置文件；</li>
<li>datasets: 存放数据集的地方；</li>
<li>deteectron2：运行代码的核心组建；</li>
<li>tools：提供了运行代码的入口以及一切可视化的代码问价。</li>
</ul>
</li>
<li><p>Tutorial部分</p>
<ul>
<li>demo：demo；</li>
<li>docs：docs；</li>
<li>tests：tests；</li>
<li>projects：提供了真实的项目代码示例；</li>
</ul>
</li>
</ol>
<h1 id="2-代码逻辑分析"><a href="#2-代码逻辑分析" class="headerlink" title="2. 代码逻辑分析"></a>2. 代码逻辑分析</h1><h2 id="2-1-超参数配置"><a href="#2-1-超参数配置" class="headerlink" title="2.1 超参数配置"></a>2.1 超参数配置</h2><p>Detectron2中的参数配置使用了yacs这个库，这个库能够很好地重用和拼接超参数文件配置。我们先看一下<code>detrctron2/config/</code>的文件结构：</p>
<ul>
<li>compat.py: 应该是对之前的Detectron库的兼容吧，可忽略。</li>
<li>config.py: 定义了一个<code>CfgNode</code>类，这个类继承自<code>fvcore</code>库(fb写的一个共公共库，提供一些共享的函数，方便各种不同项目使用)中定义的<code>CfgNode</code>,总之就是不断继承。。。继承关系是这样的：<code>detrctron2.config.CfgNode-&gt;fcvore.common.config.CfgNode-&gt;yacs.config.CfgNode-&gt;dict</code>。另外该文件还提供了<code>get_cfg()</code>方法，该方法会返回一个含有默认配置的<code>CfgNode</code>,而这些默认的配置值在下面的<code>default.py</code>中定义了，之所以这样做是因为要配置的默认值太多了，所以为了文档清晰才写到了一个新的文件中去，不过，yacs库的作者也建议这样做。</li>
<li>default.py: 如上面所说，该文件定义了各种参数的默认值。</li>
</ul>
<p>了解配置函数的方法后我们再回到<code>tools/train_net.py</code>，我们一行一行的来理解。</p>
<ul>
<li><code>tools/train_net.py</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> detectron2.config <span class="keyword">import</span> get_cfg</span><br><span class="line"><span class="keyword">from</span> detectron2.engine <span class="keyword">import</span> DefaultTrainer, default_argument_parser, default_setup, hooks, launch</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setup</span><span class="params">(args)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Create configs and perform basic setups.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    cfg = get_cfg() </span><br><span class="line">    cfg.merge_from_file(args.config_file) </span><br><span class="line">    cfg.merge_from_list(args.opts)</span><br><span class="line">    cfg.freeze()</span><br><span class="line">    default_setup(cfg, args)</span><br><span class="line">    <span class="keyword">return</span> cfg</span><br></pre></td></tr></table></figure>

<ul>
<li><code>cfg = get_cfg()</code>： 获取已经配置好默认参数的cfg</li>
<li><code>cfg.merge_from_file(args.config_file)</code>：<code>config_file</code>是指定的yaml配置文件，通过<code>merge_from_file</code>这个函数会将yaml文件中指定的超参数对默认值进行覆盖。</li>
<li><code>cfg.merge_from_list(args.opts)</code>：<code>merge_from_list</code>作用同上面的类似，只不过是通过命令行的方式覆盖。</li>
<li><code>cfg.freeze()</code>: <code>freeze</code>函数的作用是将超参数值冻结，避免被程序不小心修改。</li>
<li><code>default_setup(cfg, args)</code>：<code>default_setup</code>是<code>detectron2/engine/default.py</code>中提供的一个默认配置函数，具体是怎么配置的这里不详细说明了。不过需要知道的值这个文件中还提供了很多其他的配置函数，例如还提供了两个类：<code>DefaultPredictor</code>和<code>DefaultTrainer</code>。</li>
</ul>
<h2 id="2-2-Trainer结构"><a href="#2-2-Trainer结构" class="headerlink" title="2.2 Trainer结构"></a>2.2 Trainer结构</h2><p>既然上面提到了<code>DefaultTrainer</code>，那么我们就从这个类入手了解一下<code>detectron2.engine</code>,其代码结构如下：</p>
<ul>
<li><p><code>train_loop.py</code>：这个函数主要作用是提供了三个重要的类：</p>
<ul>
<li><code>HookBase</code>: 这是一个Hook的基类，用于指定在训练前后或者每一个step前后需要做什么事情，所以根据特定的需求需要对如下四种方法做不同的定义：<code>before_train</code>, <code>after_train</code>, <code>before_step</code>, <code>after_step</code>。以<code>before_step</code>。</li>
<li><code>TrainerBase</code>: 该类中定义的函数可以归纳成三种，并初始化<code>_hooks</code>为<code>[]</code>：<ul>
<li><code>register_hooks</code>:这个很好理解，就是将用户定义的一些<code>hooks</code>进行注册，<strong>说大白话就是把若干个<code>Hook</code>放在一个<code>list</code>里面去</strong>。之后只需要遍历这个<code>list</code>依次执行就可以了。<ul>
<li><code>register_hooks(hooks)</code>会将输入的<code>hooks</code>中的<code>trainer</code>设置为当前的类实例的弱引用，并将其添加到当前类实例的<code>self._hooks</code>中去；</li>
</ul>
</li>
<li>第二类其实就是上面提到的遍历<code>hook list</code>并执行<code>hook</code>，不过这个遍历有四种，分别是<code>before_train</code>,<code>after_train</code>,<code>before_step</code>,<code>after_step</code>。还有一个就是<code>run_step</code>,这个函数其实就是平常我们在编写训练过程的代码，例如读数据，训练模型，获取损失值，求导数，反向梯度更新等,只不过在这个类里面没有定义。</li>
<li>第三类就是<code>train</code>函数，它有两个参数，分别是开始的迭代数和最大的迭代数。之后就是重复依次执行第二类中的函数指定迭代次数。</li>
</ul>
</li>
<li><code>SimpleTrainer</code>:其实就是继承自<code>TrainerBase</code>,然后定义了<code>run_step</code>等方法。我们后面也可以继承这个类做进一步的自定义。<ul>
<li>初始化基类，并赋予其<code>model</code>、<code>data_loader</code>、<code>_data_loader_iter</code>、<code>optimizer</code>；</li>
<li>这在随后的训练过程中会被继承为默认的训练类<code>DefaultTrainer</code>。</li>
</ul>
</li>
</ul>
</li>
<li><p><code>defaults.py</code>: 上面已介绍，提供了两个类：<code>DefaultPredictor</code>和<code>DefaultTrainer</code>，这个<code>DefaultTrainer</code>就继承自<code>SimpleTrainer</code>,所以存在如下继承关系：<code>detectron2.engine.default.DefaultTrainer-&gt;detectron2.engine.train_loop.SimpleTrainer-&gt;detectron2.engine.train_loop.TrainerBase</code></p>
</li>
<li><p><code>hooks.py</code>:定义了很多继承自<code>train_loop.HookBase的Hook</code>。</p>
<ul>
<li><code>CallBackHook</code>: Create a hook using callback functions provided by the user.</li>
<li><code>IterationTimer</code>：Track the time spent for each iteration (each run_step call in the trainer). Print a summary in the end of training.；</li>
<li><code>PeriodicWriter</code>：Write events to EventStorage periodically.</li>
<li><code>PeriodicCheckpointer</code>：Same as :class:<code>detectron2.checkpoint.PeriodicCheckpointer</code>, but as a hook.</li>
<li><code>LRScheduler</code>：A hook which executes a torch builtin LR scheduler and summarizes the LR. It is executed after every iteration.</li>
<li><code>AutogradProfiler</code>：A hook which runs <code>torch.autograd.profiler.profile</code>.</li>
<li><code>EvalHook</code>: Run an evaluation function periodically, and at the end of training.</li>
<li><code>PreciseBN</code>: The standard implementation of BatchNorm uses EMA in inference, which is sometimes suboptimal. This class computes the true average of statistics rather than the moving average, and put true averages to every BN layer in the given model.</li>
</ul>
</li>
<li><p><code>launch.py</code>: 前面提到过，可以理解成代码启动器，可以根据命令决定是否采用分布式训练（或者单机多卡）或者单机单卡训练。</p>
</li>
</ul>
<p>整个训练过程按照如下流程进行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">self.before_train()</span><br><span class="line"><span class="keyword">for</span> self.iter <span class="keyword">in</span> range(start_iter, max_iter):</span><br><span class="line">  self.before_step()</span><br><span class="line">  self.run_step()</span><br><span class="line">  self.after_step()</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">  self.after_train()</span><br></pre></td></tr></table></figure>

<p>小结：<br><img src="/home/ubuntu/Workspace/detectron2/materials/ggbjq2bbwo.png" alt="fig-1"></p>
<h2 id="2-3-Trainer解析"><a href="#2-3-Trainer解析" class="headerlink" title="2.3 Trainer解析"></a>2.3 Trainer解析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(args)</span>:</span></span><br><span class="line">    cfg = setup(args)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> args.eval_only:</span><br><span class="line">        ...</span><br><span class="line">    trainer = Trainer(cfg)</span><br><span class="line">    trainer.resume_or_load(resume=args.resume)</span><br><span class="line">    <span class="keyword">if</span> cfg.TEST.AUG.ENABLED:</span><br><span class="line">        trainer.register_hooks(</span><br><span class="line">            [hooks.EvalHook(<span class="number">0</span>, <span class="keyword">lambda</span>: trainer.test_with_TTA(cfg, trainer.model))]</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> trainer.train()</span><br></pre></td></tr></table></figure>

<h3 id="2-3-1-build-方法"><a href="#2-3-1-build-方法" class="headerlink" title="2.3.1 build_*方法"></a>2.3.1 build_*方法</h3><p><code>build_*</code>主要来自于<code>engine.defaults.DefaultTrainer</code>类，继承自<code>engine.train_loop.SimpleTrainer</code>类。而<code>detectron2.engine.default.DefaultTrainer</code>在其<code>__init__(self, cfg)</code>函数中定义了解析cfg。如下面代码所示，cfg会作为参数倍若干个<code>build_*</code>方法解析，得到解析后的<code>model,optimizer</code>,<code>data_loader</code>等。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> detectron2.modeling <span class="keyword">import</span> build_model</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DefaultTrainer</span><span class="params">(SimpleTrainer)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, cfg)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        cfg (CfgNode):</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># Assume these objects must be constructed in this order.</span></span><br><span class="line">    model = self.build_model(cfg)</span><br><span class="line">    optimizer = self.build_optimizer(cfg, model)</span><br><span class="line">    data_loader = self.build_train_loader(cfg)</span><br><span class="line">    </span><br><span class="line">    ... </span><br><span class="line">    </span><br><span class="line">    self.register_hooks(self.build_hooks())</span><br><span class="line">      </span><br><span class="line"><span class="meta">  @classmethod</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">build_model</span><span class="params">(cls, cfg)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        torch.nn.Module:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    model = build_model(cfg)</span><br><span class="line">    logger = logging.getLogger(__name__)</span><br><span class="line">    logger.info(<span class="string">"Model:\n&#123;&#125;"</span>.format(model))</span><br><span class="line">    <span class="keyword">return</span> model</span><br></pre></td></tr></table></figure>

<p>下面我们以<code>DefaultTrainer.build_model</code>为例来介绍注册机制,该方法调用了<code>detectron2/modeling/meta_arch/build.py</code>的<code>build_model</code>函数,其源代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> detectron2.utils.registry <span class="keyword">import</span> Registry</span><br><span class="line"></span><br><span class="line">META_ARCH_REGISTRY = Registry(<span class="string">"META_ARCH"</span>)</span><br><span class="line">META_ARCH_REGISTRY.__doc__ = <span class="string">"""..."""</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_model</span><span class="params">(cfg)</span>:</span></span><br><span class="line">  <span class="string">"""</span></span><br><span class="line"><span class="string">  Built the whole model, defined by `cfg.MODEL.META_ARCHITECTURE`.</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line">  meta_arch = cfg.MODEL.META_ARCHITECTURE</span><br><span class="line">  <span class="keyword">return</span> META_ARCH_REGISTRY.get(meta_arch)(cfg)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>meta_arch = cfg.MODEL.META_ARCHITECTURE</code>： 根据超参数获得网络结构的名字</li>
<li><code>return META_ARCH_REGISTRY.get(meta_arch)(cfg)</code>：<code>META_ARCH_REGISTRY</code>是一个<code>Registry</code>类(这个在后面会详细介绍)，可以将这一行代码拆成如下几个步骤：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model = META_ARCH_REGISTRY.get(meta_arch)</span><br><span class="line"><span class="keyword">return</span> model(cfg)</span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-注册机制Registry"><a href="#2-3-2-注册机制Registry" class="headerlink" title="2.3.2 注册机制Registry"></a>2.3.2 注册机制Registry</h3><p>假如你想自己实现一个新的backbone网络，那么你可以这样做:</p>
<p>首先在detectron2中定义好如下（实际上已经定义了）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># detectron2/modeling/backbone/build.py</span></span><br><span class="line"></span><br><span class="line">BACKBONE_REGISTRY = Registry(<span class="string">'BACKBONE'</span>)</span><br></pre></td></tr></table></figure>

<p>之后在你创建的新的文件下按如下方式创建你的backbone</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># detectron2/modeling/backbone/your_backbone.py</span></span><br><span class="line"><span class="keyword">from</span> .build <span class="keyword">import</span> BACKBONE_REGISTRY</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式1</span></span><br><span class="line"><span class="meta">@BACKBONE_REGISTRY.register()</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyBackbone</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 方式2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyBackbone</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br><span class="line">BACKBONE_REGISTRY.register(MyBackbone)</span><br></pre></td></tr></table></figure>

<p><code>Registry</code>源代码如下（有删减）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Registry</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">    self._name = name</span><br><span class="line">    self._obj_map = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_do_register</span><span class="params">(self, name, obj)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> (</span><br><span class="line">      name <span class="keyword">not</span> <span class="keyword">in</span> self._obj_map</span><br><span class="line">    ), <span class="string">"An object named '&#123;&#125;' was already registered in '&#123;&#125;' registry!"</span>.format(name, self._name)</span><br><span class="line">    self._obj_map[name] = obj</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(self, obj=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> obj <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">      <span class="comment"># used as a decorator</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">deco</span><span class="params">(func_or_class)</span>:</span></span><br><span class="line">        name = func_or_class.__name__</span><br><span class="line">        self._do_register(name, func_or_class)</span><br><span class="line">        <span class="keyword">return</span> func_or_class</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> deco</span><br><span class="line"></span><br><span class="line">    <span class="comment"># used as a function call</span></span><br><span class="line">    name = obj.__name__</span><br><span class="line">    self._do_register(name, obj)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, name)</span>:</span></span><br><span class="line">    ret = self._obj_map.get(name)</span><br><span class="line">    <span class="keyword">if</span> ret <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">      <span class="keyword">raise</span> KeyError(<span class="string">"No object named '&#123;&#125;' found in '&#123;&#125;' registry!"</span>.format(name, self._name))</span><br><span class="line">    <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure>

<ul>
<li>首先是<code>__init__</code>部分：<ul>
<li><code>self._name</code>则是你要注册的名字，例如对于完整的模型而言，<code>name</code>一般取<code>META_ARCH</code>。当然如果你需要自定义<code>backbone</code>网络，你也可以定义一个<code>Registry(&#39;BACKBONE&#39;)</code>;</li>
<li><code>self._obj_map</code>:其实就是一个字典。以模型为例，<code>key</code>就是你的模型名字，而<code>value</code>就是对应的模型类。这样你在传参时只需要修改一下模型名字就能使用不同的模型了。具体实现方法就是后面这几个函数;</li>
</ul>
</li>
<li><code>register</code>: 可以看到该方法定义了注册的两种方式，一种是当<code>obj==None</code>的时候，使用装饰器的方式注册，另外一种就是直接将obj作为参数调用<code>_do_register</code>进行注册。</li>
<li><code>_do_register</code>:真正注册的函数，可以看到它首先会判断name是否已经存在于<code>self._obj_map</code>了。什么意思呢？还是以backbone为例，我们定义了一个<code>BACKBONE_REGISTRY = Registry(&#39;BACKBONE&#39;)</code>,然后又定义了很多种<code>backbone</code>，而这些<code>backbone</code>都使用<code>@BACKBONE_REGISTRY.register()</code>的方式注册到了<code>BACKBONE_REGISTRY._obj_map</code>中了,所以才取名为<code>Registry</code>。</li>
</ul>
<h2 id="2-4-Detectron2-整体代码框架"><a href="#2-4-Detectron2-整体代码框架" class="headerlink" title="2.4 Detectron2 整体代码框架"></a>2.4 Detectron2 整体代码框架</h2><p>整体框架如下图所示：</p>
<p><img src="/home/ubuntu/Workspace/detectron2/materials/0y66sksfp3.png" alt="fig-2"></p>
<h1 id="3-Dataset"><a href="#3-Dataset" class="headerlink" title="3. Dataset"></a>3. Dataset</h1><p><strong>构建<code>data_loader</code>原理步骤</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># engine/default.py</span></span><br><span class="line"><span class="keyword">from</span> detectron2.data <span class="keyword">import</span> (</span><br><span class="line">  MetadataCatalog,</span><br><span class="line">  build_detection_test_loader,</span><br><span class="line">  build_detection_train_loader,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DefaultTrainer</span><span class="params">(SimpleTrainer)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, cfg)</span>:</span></span><br><span class="line">    <span class="comment"># Assume these objects must be constructed in this order.</span></span><br><span class="line">    data_loader = self.build_train_loader(cfg)</span><br><span class="line">  </span><br><span class="line">    ...</span><br><span class="line">  </span><br><span class="line"><span class="meta">  @classmethod</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">build_train_loader</span><span class="params">(cls, cfg)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">      iterable</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> build_detection_train_loader(cfg)</span><br></pre></td></tr></table></figure>

<p>函数调用关系如下图：</p>
<p><img src="/home/ubuntu/Workspace/detectron2/materials/hpnl6x7tcn.png" alt="fig-3"></p>
<p>结合前面两篇文章的内容可以看到<code>detectron2</code>在构建<code>model,optimizer</code>和<code>data_loader</code>的时候都是在对应的<code>build.py</code>文件里实现的。我们看一下<code>build_detection_train_loader</code>是如何定义的(对应上图中紫色方框内的部分(自下往上的顺序)）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_detection_train_loader</span><span class="params">(cfg, mapper=None)</span>:</span></span><br><span class="line">  <span class="string">"""</span></span><br><span class="line"><span class="string">  A data loader is created by the following steps:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  1. Use the dataset names in config to query :class:`DatasetCatalog`, and obtain a list of dicts.</span></span><br><span class="line"><span class="string">  2. Start workers to work on the dicts. Each worker will:</span></span><br><span class="line"><span class="string">    * Map each metadata dict into another format to be consumed by the model.</span></span><br><span class="line"><span class="string">    * Batch them by simply putting dicts into a list.</span></span><br><span class="line"><span class="string">  The batched ``list[mapped_dict]`` is what this dataloader will return.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Args:</span></span><br><span class="line"><span class="string">    cfg (CfgNode): the config</span></span><br><span class="line"><span class="string">    mapper (callable): a callable which takes a sample (dict) from dataset and</span></span><br><span class="line"><span class="string">      returns the format to be consumed by the model.</span></span><br><span class="line"><span class="string">      By default it will be `DatasetMapper(cfg, True)`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Returns:</span></span><br><span class="line"><span class="string">    a torch DataLoader object</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line"><span class="comment"># 1. 获得dataset_dicts</span></span><br><span class="line">  dataset_dicts = get_detection_dataset_dicts(</span><br><span class="line">    cfg.DATASETS.TRAIN,</span><br><span class="line">    filter_empty=<span class="literal">True</span>,</span><br><span class="line">    min_keypoints=cfg.MODEL.ROI_KEYPOINT_HEAD.MIN_KEYPOINTS_PER_IMAGE</span><br><span class="line">    <span class="keyword">if</span> cfg.MODEL.KEYPOINT_ON</span><br><span class="line">    <span class="keyword">else</span> <span class="number">0</span>,</span><br><span class="line">    proposal_files=cfg.DATASETS.PROPOSAL_FILES_TRAIN <span class="keyword">if</span> cfg.MODEL.LOAD_PROPOSALS <span class="keyword">else</span> <span class="literal">None</span>,</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 将dataset_dicts转化成torch.utils.data.Dataset</span></span><br><span class="line">  dataset = DatasetFromList(dataset_dicts, copy=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 进一步转化成MapDataset，每次读取数据时都会调用mapper来对dict进行解析</span></span><br><span class="line">  <span class="keyword">if</span> mapper <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    mapper = DatasetMapper(cfg, <span class="literal">True</span>)</span><br><span class="line">  dataset = MapDataset(dataset, mapper)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 采样器</span></span><br><span class="line">  sampler_name = cfg.DATALOADER.SAMPLER_TRAIN</span><br><span class="line">  <span class="keyword">if</span> sampler_name == <span class="string">"TrainingSampler"</span>:</span><br><span class="line">    sampler = samplers.TrainingSampler(len(dataset))</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  batch_sampler = build_batch_data_sampler(</span><br><span class="line">    sampler, images_per_worker, group_bin_edges, aspect_ratios</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 数据迭代器 data_loader</span></span><br><span class="line">  data_loader = torch.utils.data.DataLoader(</span><br><span class="line">    dataset,</span><br><span class="line">    num_workers=cfg.DATALOADER.NUM_WORKERS,</span><br><span class="line">    batch_sampler=batch_sampler,</span><br><span class="line">    collate_fn=trivial_batch_collator,</span><br><span class="line">    worker_init_fn=worker_init_reset_seed,</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> data_loader</span><br></pre></td></tr></table></figure>

<p>后面的采样器和data_loader可以参阅<a href="https://www.cnblogs.com/marsggbo/p/11308889.html" target="_blank" rel="noopener">https://www.cnblogs.com/marsggbo/p/11308889.html</a>一文弄懂Pytorch的DataLoader, DataSet, Sampler之间的关系。</p>
<h2 id="3-1-获取dataset-dicts"><a href="#3-1-获取dataset-dicts" class="headerlink" title="3.1 获取dataset_dicts"></a>3.1 获取<code>dataset_dicts</code></h2><p><code>get_detection_dataset_dicts(dataset_names)</code>函数需要传递的一个重要参数是<code>dataset_names</code>,这个参数其实就是一个字符串，用来指定数据集的名称。通过这个字符串，该函数会调用<code>data/catalog.py</code>的<code>DatasetCatalog</code>类来进行解析得到一个包含数据信息的字典。</p>
<p>解析的原理是：<code>DatasetCatalog</code>有一个字典<code>_REGISTERED</code>，默认已经注册好了例如<code>coco</code>, <code>voc</code>这些数据集的信息。如果你想要使用你自己的数据集，那么你需要在最开始前你需要定义你的数据集名字以及定义一个函数(这个函数不需要传参，而且最后会返回一个<code>dict</code>，该<code>dict</code>包含你的数据集信息)，举个栗子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> detectron2.data <span class="keyword">import</span> DatasetCatalog</span><br><span class="line">my_dataset_name = <span class="string">'apple'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_dicts</span><span class="params">()</span>:</span></span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">return</span> dict</span><br><span class="line"></span><br><span class="line">DatasetCatalog.register(my_dataset_name, get_dicts)</span><br></pre></td></tr></table></figure>

<p>当然，如果你的数据集已经是COCO的格式了，那么你也可以使用如下方法进行注册：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> detectron2.data.datasets <span class="keyword">import</span> register_coco_instances</span><br><span class="line">my_dataset_name = <span class="string">'apple'</span></span><br><span class="line">register_coco_instances(my_dataset_name, &#123;&#125;, <span class="string">"json_annotation.json"</span>, <span class="string">"path/to/image/dir"</span>)</span><br></pre></td></tr></table></figure>

<p>最后，<code>get_detection_dataset_dicts</code>会返回一个包含若干个<code>dict</code>的<code>list</code>，之所以是<code>lis</code>t是因为参数<code>dataset_names</code>也是一个<code>list</code>，这样我们就可以制定多个<code>names</code>来同时对数据进行读取。</p>
<h2 id="3-2-解析成DatasetFromList"><a href="#3-2-解析成DatasetFromList" class="headerlink" title="3.2 解析成DatasetFromList"></a>3.2 解析成<code>DatasetFromList</code></h2><p><code>DatasetFromList(dataset_dict)</code>函数定义在<code>detectron2/data/common.py</code>中，它其实就是一个<code>torch.utils.data.Dataset</code>类，其源码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DatasetFromList</span><span class="params">(data.Dataset)</span>:</span></span><br><span class="line">  <span class="string">"""</span></span><br><span class="line"><span class="string">  Wrap a list to a torch Dataset. It produces elements of the list as data.</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, lst: list, copy: bool = True)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      lst (list): a list which contains elements to produce.</span></span><br><span class="line"><span class="string">      copy (bool): whether to deepcopy the element when producing it,</span></span><br><span class="line"><span class="string">        so that the result can be modified in place without affecting the</span></span><br><span class="line"><span class="string">        source in the list.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    self._lst = lst</span><br><span class="line">    self._copy = copy</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> len(self._lst)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, idx)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> self._copy:</span><br><span class="line">      <span class="keyword">return</span> copy.deepcopy(self._lst[idx])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> self._lst[idx]</span><br></pre></td></tr></table></figure>

<h3 id="3-3-将DatasetFromList转化为MapDataset"><a href="#3-3-将DatasetFromList转化为MapDataset" class="headerlink" title="3.3 将DatasetFromList转化为MapDataset"></a>3.3 将<code>DatasetFromList</code>转化为<code>MapDataset</code></h3><p>其实<code>DatsetFromList</code>和<code>MapDatase</code>t都是<code>torch.utils.data.Dataset</code>的子类，那他们的区别是什么呢？很简单，区别就是后者使用了<code>mapper</code>。</p>
<p>在解释<code>mapper</code>是什么之前我们首先要知道的是，在<code>detectron2</code>中，一张图片对应的是一个<code>dict</code>，那么整个数据集就是<code>listdict</code>。之后我们再看<code>DatsetFromList</code>，它的<code>__getitem__</code>函数非常简单，它只是简单粗暴地就返回了指定idx的元素。显然这样是不行的，因为在把数据扔给模型训练之前我们肯定还要对数据做一定的处理，而这个工作就是由<code>mapper</code>来做的，默认情况下使用的是<code>detectron2/data/dataset_mapper.py</code>中定义的<code>DatasetMapper</code>，如果你需要自定义一个<code>mapper</code>也可以参考这个写。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DatasetMapper(cfg, is_train=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>我们继续了解一下<code>DatasetMapper</code>的实现原理，首先看一下官方给的定义：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">A callable which takes a dataset dict in Detectron2 Dataset format,</span></span><br><span class="line"><span class="string">and map it into a format used by the model.</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<p>简单概括就是这个类是可调用的(callable),所以在下面的源码中可以看到定义了<code>__call__</code>方法。</p>
<p>该类主要做了这三件事：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">The callable currently does the following:</span><br><span class="line">1. Read the image from &quot;file_name&quot;</span><br><span class="line">2. Applies cropping/geometric transforms to the image and annotations</span><br><span class="line">3. Prepare data and annotations to Tensor and :class:`Instances`</span><br></pre></td></tr></table></figure>

<p>其源码如下（有删减）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DatasetMapper</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, cfg, is_train=True)</span>:</span></span><br><span class="line">  <span class="comment"># 读取cfg的参数</span></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, dataset_dict)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        dataset_dict (dict): Metadata of one image, in Detectron2 Dataset format.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        dict: a format that builtin models in detectron2 accept</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    dataset_dict = copy.deepcopy(dataset_dict)  <span class="comment"># it will be modified by code below</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 1. 读取图像数据</span></span><br><span class="line">    image = utils.read_image(dataset_dict[<span class="string">"file_name"</span>], format=self.img_format)</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 2. 对image和box等做Transformation</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"annotations"</span> <span class="keyword">not</span> <span class="keyword">in</span> dataset_dict:</span><br><span class="line">      image, transforms = T.apply_transform_gens(</span><br><span class="line">        ([self.crop_gen] <span class="keyword">if</span> self.crop_gen <span class="keyword">else</span> []) + self.tfm_gens, image</span><br><span class="line">      )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">    ...</span><br><span class="line">      image, transforms = T.apply_transform_gens(self.tfm_gens, image)</span><br><span class="line">      <span class="keyword">if</span> self.crop_gen:</span><br><span class="line">        transforms = crop_tfm + transforms</span><br><span class="line"></span><br><span class="line">      image_shape = image.shape[:<span class="number">2</span>]  <span class="comment"># h, w</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 3.将数据转化成tensor格式</span></span><br><span class="line">    dataset_dict[<span class="string">"image"</span>] = torch.as_tensor(image.transpose(<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>).astype(<span class="string">"float32"</span>))</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dataset_dict</span><br></pre></td></tr></table></figure>

<p><code>MapDataset</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MapDataset</span><span class="params">(data.Dataset)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, dataset, map_func)</span>:</span></span><br><span class="line">    self._dataset = dataset</span><br><span class="line">    self._map_func = PicklableWrapper(map_func)  <span class="comment"># wrap so that a lambda will work</span></span><br><span class="line"></span><br><span class="line">    self._rng = random.Random(<span class="number">42</span>)</span><br><span class="line">    self._fallback_candidates = set(range(len(dataset)))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> len(self._dataset)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, idx)</span>:</span></span><br><span class="line">    retry_count = <span class="number">0</span></span><br><span class="line">    cur_idx = int(idx)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">      data = self._map_func(self._dataset[cur_idx])</span><br><span class="line">      <span class="keyword">if</span> data <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        self._fallback_candidates.add(cur_idx)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">        <span class="comment"># _map_func fails for this idx, use a random new index from the pool</span></span><br><span class="line">        retry_count += <span class="number">1</span></span><br><span class="line">        self._fallback_candidates.discard(cur_idx)</span><br><span class="line">        cur_idx = self._rng.sample(self._fallback_candidates, k=<span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> retry_count &gt;= <span class="number">3</span>:</span><br><span class="line">          logger = logging.getLogger(__name__)</span><br><span class="line">          logger.warning(</span><br><span class="line">            <span class="string">"Failed to apply `_map_func` for idx: &#123;&#125;, retry count: &#123;&#125;"</span>.format(</span><br><span class="line">              idx, retry_count</span><br><span class="line">            )</span><br><span class="line">          )</span><br></pre></td></tr></table></figure>

<ul>
<li><code>self._fallback_candidates</code>是一个<code>set</code>,它的特点是其中的元素是独一无二的，定义这个的作用是记录可正常读取的数据索引，因为有的数据可能无法正常读取，所以这个时候我们就可以把这个坏数据的索引从<code>_fallback_candidates</code>中剔除，并随机采样一个索引来读取数据。</li>
<li><code>__getitem__</code>中的逻辑就是首先读取指定索引的数据，如果正常读取就把该所索引值加入到<code>_fallback_candidates</code>中去；反之，如果数据无法读取，则将对应索引值删除，并随机采样一个数据，并且尝试3次，若3次后都无法正常读取数据，则报错，但是好像也没有退出程序，而是继续读数据，可能是以为总有能正常读取的数据吧;</li>
</ul>
<h1 id="3-Debug"><a href="#3-Debug" class="headerlink" title="3. Debug"></a>3. Debug</h1><h2 id="3-1-Using-ground-py"><a href="#3-1-Using-ground-py" class="headerlink" title="3.1 Using ground.py"></a>3.1 Using ground.py</h2><h1 id="4-Training"><a href="#4-Training" class="headerlink" title="4. Training"></a>4. Training</h1><h2 id="4-1-在COCO数据集上训练"><a href="#4-1-在COCO数据集上训练" class="headerlink" title="4.1 在COCO数据集上训练"></a>4.1 在COCO数据集上训练</h2><p>Using 1 image per batch, cause the desktop can’t afford 2 images per batch.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python tools/train_net.py \</span><br><span class="line">	--config-file configs/COCO-Keypoints/keypoint_rcnn_R_50_FPN_1x.yaml \</span><br><span class="line">	SOLVER.IMS_PER_BATCH 1 SOLVER.BASE_LR 0.0025</span><br></pre></td></tr></table></figure>

<p>Training parameters:</p>
<ul>
<li>max_mem: 2638M;</li>
<li>89999 iterations;</li>
<li>The training log is saved to log_1127_first_training.txt;</li>
</ul>
<h2 id="4-2-训练流程"><a href="#4-2-训练流程" class="headerlink" title="4.2 训练流程"></a>4.2 训练流程</h2><p>主要训练函数为<code>tools/train_net.py</code>中的<code>main</code>函数，<code>launch</code>函数将训练过程分布化，在当前阶段暂时不予深究。</p>
<h1 id="5-Validation"><a href="#5-Validation" class="headerlink" title="5. Validation"></a>5. Validation</h1><p>python demo/demo.py <br>  –config-file configs/COCO-Keypoints/keypoint_rcnn_R_50_FPN_1x.yaml <br>  –input comunity/1574912817253.png <br>  –opts MODEL.WEIGHTS weights/COCO-Keypoints/model_final_04e291.pkl</p>

          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/16/CPP-Primer-Chapter-5-Statements/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zepyhrus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/11/16/CPP-Primer-Chapter-5-Statements/" class="post-title-link" itemprop="url">CPP Primer Chapter 5 Statements</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-11-16 11:51:12" itemprop="dateCreated datePublished" datetime="2019-11-16T11:51:12+08:00">2019-11-16</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-15 19:14:52" itemprop="dateModified" datetime="2020-01-15T19:14:52+08:00">2020-01-15</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="Chapter-5-语句"><a href="#Chapter-5-语句" class="headerlink" title="Chapter 5 语句"></a>Chapter 5 语句</h1><p>和大多数语言一样，C++提供了条件执行语句、重复执行相同代码的循环语句和用于中断当前控制流的跳转语句。</p>
<h2 id="5-1-简单语句"><a href="#5-1-简单语句" class="headerlink" title="5.1 简单语句"></a>5.1 简单语句</h2><p><strong>空语句</strong></p>
<p><strong>BEST PRACTICE</strong>：使用空语句时最好是加上注释，从而令独这段代码的人知道该语句是有意省略的。</p>
<p><strong>WARNING</strong>：多余的空语句并非总是无害的。</p>
<p><strong>复合语句（块）</strong></p>
<p>复合语句块是指被<code>{}</code>括起来的语句和声明序列，也被成为block。</p>
<h2 id="5-2-语句作用域"><a href="#5-2-语句作用域" class="headerlink" title="5.2 语句作用域"></a>5.2 语句作用域</h2><h2 id="5-3-条件语句"><a href="#5-3-条件语句" class="headerlink" title="5.3 条件语句"></a>5.3 条件语句</h2><p><strong>悬挂else</strong>：C++规定<code>else</code>与离它最近的尚未匹配的<code>if</code>匹配。</p>
<h3 id="5-3-2-switch-语句"><a href="#5-3-2-switch-语句" class="headerlink" title="5.3.2  switch 语句"></a>5.3.2  <code>switch</code> 语句</h3><p><strong>switch 内部的控制流</strong>：如果某个<code>case</code>匹配成功，将错哦你该标签开始往后顺序执行所有<code>case</code>分支，除非程序显式地中断了这一过程。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> vowelCnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (ch)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'a'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'e'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'i'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'o'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'u'</span>:</span><br><span class="line">    ++vowelCnt;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>case</code> 标签之后不一定非得换行。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (ch) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'a'</span>: <span class="keyword">case</span> <span class="string">'e'</span>: <span class="keyword">case</span> <span class="string">'i'</span>: <span class="keyword">case</span> <span class="string">'o'</span>: <span class="keyword">case</span> <span class="string">'u'</span>:</span><br><span class="line">    ++vowelCnt;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>WARNING</strong>：常见的错觉是程序只执行匹配成功的那个<code>case</code>分支语句。因此在每个标签后写上<code>break</code>，是最好的应用。这样新增加新的分支也不用在前面加上<code>break</code>了。</p>
<p><strong>default 标签</strong>：当没有任何一个<code>case</code>标签能匹配上<code>switch</code>表达式的值时，程序将执行紧跟在<code>default</code>后面的语句。每一个<code>switch</code>语句。</p>
<h2 id="5-4-迭代语句"><a href="#5-4-迭代语句" class="headerlink" title="5.4 迭代语句"></a>5.4 迭代语句</h2><h3 id="5-4-3-范围for语句"><a href="#5-4-3-范围for语句" class="headerlink" title="5.4.3 范围for语句"></a>5.4.3 范围<code>for</code>语句</h3><p><strong>序列</strong>：可以返回迭代器<code>begin</code>和<code>end</code>的成员。采用范围<code>for</code>语句时，在迭代过程中修改序列结果，可能会导致循环体的尾指针失效。</p>
<h2 id="5-5-跳转语句"><a href="#5-5-跳转语句" class="headerlink" title="5.5 跳转语句"></a>5.5 跳转语句</h2><p>C++ 提供了4种跳转语句：<code>break</code>、<code>continue</code>、<code>goto</code>、<code>return</code>。</p>
<h3 id="5-5-1-break语句"><a href="#5-5-1-break语句" class="headerlink" title="5.5.1 break语句"></a>5.5.1 <code>break</code>语句</h3><p><code>break</code>语句的作用范围仅限于最近的循环或者<code>switch</code>。</p>
<h3 id="5-5-2-continue语句"><a href="#5-5-2-continue语句" class="headerlink" title="5.5.2 continue语句"></a>5.5.2 <code>continue</code>语句</h3><p><code>continue</code>语句只出现在<code>for</code>、<code>while</code>、<code>do while</code>循环内，或者嵌套在此类循环的语句或块的内部。</p>
<h3 id="5-5-3-goto语句"><a href="#5-5-3-goto语句" class="headerlink" title="5.5.3 goto语句"></a>5.5.3 <code>goto</code>语句</h3><p>hmmmm，没什么可说的。</p>
<h2 id="5-6-try语句"><a href="#5-6-try语句" class="headerlink" title="5.6 try语句"></a>5.6 <code>try</code>语句</h2><ul>
<li><code>throw</code>表达式；</li>
<li><code>try</code>语句块；</li>
<li>一套<strong>异常</strong>类。</li>
</ul>
<h3 id="5-6-1-throw表达式"><a href="#5-6-1-throw表达式" class="headerlink" title="5.6.1 throw表达式"></a>5.6.1 <code>throw</code>表达式</h3><p>见练习5.22.cpp。</p>
<h3 id="5-6-2-try语句块"><a href="#5-6-2-try语句块" class="headerlink" title="5.6.2 try语句块"></a>5.6.2 <code>try</code>语句块</h3>
          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/12/Pytorch-Notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zepyhrus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/09/12/Pytorch-Notes/" class="post-title-link" itemprop="url">Pytorch Notes</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-09-12 10:15:29 / Modified: 10:47:22" itemprop="dateCreated datePublished" datetime="2019-09-12T10:15:29+08:00">2019-09-12</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="Pytorch-Notes"><a href="#Pytorch-Notes" class="headerlink" title="Pytorch Notes"></a>Pytorch Notes</h1><p>This notes mostly comes from source code from pytorch just to summarize the most import part of those most frequently used functions.</p>
<h2 id="torchvision"><a href="#torchvision" class="headerlink" title="torchvision"></a>torchvision</h2><h3 id="transforms"><a href="#transforms" class="headerlink" title="transforms"></a>transforms</h3><h4 id="ToTensor"><a href="#ToTensor" class="headerlink" title="..ToTensor()"></a><em>.</em>.ToTensor()</h4><p><code>torchvision.tansforms.functional(pic)</code>: Convert a <code>PIL Image</code> or <code>numpy.ndarray</code> to tensor.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This will divide image pixel value by 255.0 to normalize it into [0, 1.0]</span></span><br><span class="line">img = img.transpose(<span class="number">0</span>, <span class="number">1</span>).transpose(<span class="number">0</span>, <span class="number">2</span>).contiguous()</span><br><span class="line"><span class="keyword">if</span> isinstance(img, torch.ByteTensor):</span><br><span class="line">    <span class="keyword">return</span> img.float().div(<span class="number">255</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">return</span> img</span><br></pre></td></tr></table></figure>

<h4 id="Normalize"><a href="#Normalize" class="headerlink" title="..Normalize()"></a><em>.</em>.Normalize()</h4><p>Using <code>*.*.functional.normalize()</code> function: Normalize a tensor image with mean and standare deviation:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mean = torch.as_tensor(mean, dtype=dtype, device=tensor.device)</span><br><span class="line">std = torch.as_tensor(std, dtype=dtype, device=tensor.device)</span><br><span class="line">tensor.sub_(mean[:, <span class="literal">None</span>, <span class="literal">None</span>]).div_(std[:, <span class="literal">None</span>, <span class="literal">None</span>])</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/10/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zepyhrus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/09/10/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-09-10 19:26:13" itemprop="dateCreated datePublished" datetime="2019-09-10T19:26:13+08:00">2019-09-10</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-08-14 17:15:45" itemprop="dateModified" datetime="2019-08-14T17:15:45+08:00">2019-08-14</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/06/Python-Notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zepyhrus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/09/06/Python-Notes/" class="post-title-link" itemprop="url">Python Notes</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-09-06 13:05:07" itemprop="dateCreated datePublished" datetime="2019-09-06T13:05:07+08:00">2019-09-06</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-09-09 09:25:30" itemprop="dateModified" datetime="2019-09-09T09:25:30+08:00">2019-09-09</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="Python-Notes"><a href="#Python-Notes" class="headerlink" title="Python Notes"></a>Python Notes</h1><p>This is the place to take some regular notes for python.</p>
<h2 id="Numpy"><a href="#Numpy" class="headerlink" title="Numpy"></a>Numpy</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">numpy.unique(ar, return_index=<span class="literal">False</span>, return_inverse=<span class="literal">False</span>, return_counts=<span class="literal">False</span>, axis=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Pandas"><a href="#Pandas" class="headerlink" title="Pandas"></a>Pandas</h2>
          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/27/CPP-Primer-Chapter-4-Expressions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zepyhrus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/08/27/CPP-Primer-Chapter-4-Expressions/" class="post-title-link" itemprop="url">CPP Primer Chapter 4: Expressions</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-08-27 09:18:11" itemprop="dateCreated datePublished" datetime="2019-08-27T09:18:11+08:00">2019-08-27</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-16 10:55:09" itemprop="dateModified" datetime="2019-11-16T10:55:09+08:00">2019-11-16</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="Expressions"><a href="#Expressions" class="headerlink" title="Expressions"></a>Expressions</h1><h2 id="4-1-Fundamentals"><a href="#4-1-Fundamentals" class="headerlink" title="4.1 Fundamentals"></a>4.1 Fundamentals</h2><p>There ar both <em>unary operators</em> and <em>binary operators</em>.</p>
<ol>
<li>Unary operators: address-of (&amp;) and dereference (*), act on one operand;</li>
<li>Binary operators: equality (==) and multiplication (*), act on two operands;</li>
<li>Tenrary operator: takes three operands;</li>
<li>Function call: takes unlimited number of operands;</li>
</ol>
<p><strong>Operand Conversions</strong>: The small integral type operands (e.g., <code>bool</code>, <code>char</code>, <code>short</code>, etc) are generally <strong>promoted</strong> to a larger integraltype, typically int.</p>
<p><strong>Overloaded Operators</strong>:The IO library &gt;&gt; and &lt;&lt; operators we used with <code>strings</code>, <code>vectors</code>, and iterators are all overloaded operators.</p>
<p><strong>Lvalue and Rvalue</strong>: Iherited from C. Some lvalues, such as <code>const</code> objects, may not be the left-hand operand of an assignment. Moreover, some expression yield objects but return them as rvalues, not lvalues.</p>
<p>Roughly speaking:</p>
<ul>
<li>When we use an object as an rvalue, we use the object`s value (its content);</li>
<li>When we use an object as an lvalue, we use the object’s identity (its location in memory);</li>
</ul>
<p><strong>Important</strong>: We can use an lvalue when an rvalue is required, but we ccannot use an rvalue when an lvalue (i.e.., a location) is required.</p>
<ul>
<li>Assignment requiers a lvalue as itts left-hand operand and yields its left-hand operand as an lvalue;</li>
<li>The address-of operator requiers an lvalue operand and returns a pointer to its operand as an rvalue;</li>
<li>The built-in dereferenect and subscript operators and the iterator dereference and <code>string</code> and <code>vector</code> subscript operators all yield lvalues;</li>
<li>The built-in and iterator increment and decrement operators require lvalue operands and the prefix versions also yield lvalues.</li>
<li>When we apply <code>decltype</code> to an expression, the result is a reference type if the expression yields an lvalue.</li>
</ul>
<h3 id="4-1-2-Precedence-and-Associativity"><a href="#4-1-2-Precedence-and-Associativity" class="headerlink" title="4.1.2 Precedence and Associativity"></a>4.1.2 Precedence and Associativity</h3><p>Table 4.12 (p. 166) lists all the operators organized into segmentes separated by double lines.</p>
<h3 id="4-1-3-Order-of-Evaluation"><a href="#4-1-3-Order-of-Evaluation" class="headerlink" title="4.1.3 Order of Evaluation"></a>4.1.3 Order of Evaluation</h3><p>In most cases, the order of how the operands are evaluated is largely unspecified. There are four operators that do guarantee the order in which operands are evaluated. </p>
<ul>
<li>The logical AND (&amp;&amp;)  guarantees thta its left-hand operand is evaluated first. It is also guaranteed that the right -hand operand is evaluated only if the left-hand operand is true.</li>
<li>The logical OR (||);</li>
<li>The condition (? :) operator, the tenary operator;</li>
<li>The comma (,) operator;</li>
</ul>
<h2 id="4-3-Logical-and-Relational-Operatiors"><a href="#4-3-Logical-and-Relational-Operatiors" class="headerlink" title="4.3 Logical and Relational Operatiors"></a>4.3 Logical and Relational Operatiors</h2><p><strong>Short-circuit evaluation</strong>: The logical AND and OR operators always evaluate their left operand before the right. Moreover, the right operands is evalutaed <em>if and only if</em> the left operand does not determine the result:</p>
<ul>
<li>The right side of an &amp;&amp; is evalutaed if and only if the left side is true;</li>
<li>The right side of an || is evaluated if and only if the left side is false;</li>
</ul>
<h2 id="4-4-Assignment-Operatiors"><a href="#4-4-Assignment-Operatiors" class="headerlink" title="4.4 Assignment Operatiors"></a>4.4 Assignment Operatiors</h2><p>The left-hand operand of an assignment operator must be a modifiable lvalue.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1024</span> = k;     <span class="comment">// error: literals are rvalues</span></span><br><span class="line">i + j = k;    <span class="comment">// error: arithmetic expressions are rvalues</span></span><br><span class="line">ci = k;       <span class="comment">// error: ci is a const (nonmodifiable) lvalue</span></span><br></pre></td></tr></table></figure>

<p><strong>Assignment Is Right Associative</strong>: Unlike the other binary operators, assignment is right associative.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="comment">// a better way to write the loop---what the condition does is now clearer</span></span><br><span class="line"><span class="keyword">while</span> ((i = get_value()) != <span class="number">42</span>) &#123;</span><br><span class="line">  <span class="comment">// do something...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Compound Assignment Operators</strong>: There are compound assignments for each of these operators.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+=    -=    *=    /=    %=;    <span class="comment">// arithmetci operators</span></span><br><span class="line">&lt;&lt;=   &gt;&gt;=   &amp;=    ^=    |=;    <span class="comment">// bitwise operators</span></span><br></pre></td></tr></table></figure>

<p>Each compound operator is essentially equivalent to <code>a = a op b</code>.</p>
<h2 id="4-5-Increment-and-Decrement-Operators"><a href="#4-5-Increment-and-Decrement-Operators" class="headerlink" title="4.5 Increment and Decrement Operators"></a>4.5 Increment and Decrement Operators</h2><p>There are two forms of these operators: prefix and postfix. </p>
<ul>
<li>prefix: increments its operand and yields the <em>changed</em> object as its result;</li>
<li>postfix: yield a copy of the original, <em>unchanged</em> object as its result;</li>
</ul>
<p><strong>Advice</strong>: Use postfix operators only when necessary.</p>
<p><strong>Combinig Dereference and Increment in a Single Expression</strong>: The postfix versions of ++ and – are used when we want to use the current value of a variable and increment it in a single compound expression.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> pbeg = v.begin();</span><br><span class="line"><span class="comment">// print elements up to the first negative value</span></span><br><span class="line"><span class="keyword">while</span> (pbeg != v.end() &amp;&amp; *pbeg &gt;= <span class="number">0</span>)</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; *pbeg++ &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// print the current value and advance pbeg</span></span><br></pre></td></tr></table></figure>

<p><strong>Remember that operands can be evaluated in any order</strong>: Most operators give no guarantee as to the order in which operands will be evaluated.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// the behavior of the following loop is undefined!</span></span><br><span class="line"><span class="keyword">while</span> (beg != s.end() &amp;&amp; !<span class="built_in">isspace</span>(*beg))</span><br><span class="line">  \*beg = touper(\*beg++);</span><br><span class="line"></span><br><span class="line"><span class="comment">// which could be evaluated as:</span></span><br><span class="line">*beg = <span class="built_in">toupper</span>(\*beg);</span><br><span class="line">*(beg + <span class="number">1</span>) = <span class="built_in">toupper</span>(\*beg);</span><br></pre></td></tr></table></figure>

<p>Or it might evaluate it in yet some other way.</p>
<h2 id="4-6-The-Member-Access-Operators"><a href="#4-6-The-Member-Access-Operators" class="headerlink" title="4.6 The Member Access Operators"></a>4.6 The Member Access Operators</h2><p>Th dereference has a lower precedence than dot operator (member access operator).</p>
<h2 id="4-7-The-conditional-Operator"><a href="#4-7-The-conditional-Operator" class="headerlink" title="4.7 The conditional Operator"></a>4.7 The conditional Operator</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cond ? expr1 : expr2</span></span><br><span class="line"><span class="built_in">string</span> grade = (grade &lt; <span class="number">60</span>) ? <span class="string">"fail"</span> : <span class="string">"pass"</span>;</span><br></pre></td></tr></table></figure>

<p><strong>Nesting Conditional Operations</strong>: We can nest one conditional operator inside another.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> grade = (grade &gt; <span class="number">90</span>) ? <span class="string">"high"</span></span><br><span class="line">                            : (grade &lt; <span class="number">60</span>) : <span class="string">"fail"</span> : <span class="string">"pass"</span>;</span><br></pre></td></tr></table></figure>

<h2 id="4-8-The-bitwise-Operator"><a href="#4-8-The-bitwise-Operator" class="headerlink" title="4.8 The bitwise Operator"></a>4.8 The bitwise Operator</h2><p>The bitwise operators take operands of integral type that they use as a collection of bits. Because there are no guarantees for how the sign bit is handled, we strongly recommend using <code>unsigned</code> types with the bitwise operators.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> bits = <span class="number">0233</span>;  <span class="comment">// char (8 bits, 1 byte)</span></span><br><span class="line"></span><br><span class="line">bits &lt;&lt; <span class="number">8</span>;  <span class="comment">// bits promoted to int (32 bits, 4 bytes) and then shifted left by 8 bits</span></span><br><span class="line"></span><br><span class="line">bits &lt;&lt; <span class="number">31</span>; <span class="comment">// left shift 31 bits, left-most bits discarded</span></span><br><span class="line"></span><br><span class="line">bits &gt;&gt; <span class="number">3</span>;  <span class="comment">// rigth shift 3 bits, 3 right-most bits discards</span></span><br></pre></td></tr></table></figure>

<p>A bitwise operation example:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">quiz1 |= <span class="number">1U</span>L &lt;&lt; <span class="number">27</span>;     <span class="comment">// set the 27th number of quiz1 to be 1</span></span><br><span class="line">quiz1 &amp;= ~(<span class="number">1U</span>L &lt;&lt; <span class="number">27</span>);  <span class="comment">// set the 27th number of quiz1 to be 0</span></span><br></pre></td></tr></table></figure>

<p><strong>Shift Operatiors (aka IO operators) Are Left Associative</strong>: The expression:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"hi"</span> &lt;&lt; <span class="string">" there"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">( (<span class="built_in">cout</span> &lt;&lt; <span class="string">"hi"</span>) &lt;&lt; <span class="string">" there"</span> ) &lt;&lt; <span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure>

<h2 id="4-9-The-sizeof-Operator"><a href="#4-9-The-sizeof-Operator" class="headerlink" title="4.9 The sizeof Operator"></a>4.9 The sizeof Operator</h2><p>The sizeof operator returns the size, in bytes, of an expression or a type name. Under the new standard, we can use the scope operator to ask for the size of a member of a class type.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sizeof</span> Sales_data::revenue;</span><br></pre></td></tr></table></figure>

<p>Because sizeof returns the size of the entire array, we can determine the number of elements in an array by dividing the array size by the element size.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constexpr</span> <span class="keyword">size_t</span> sz = <span class="keyword">sizeof</span>(ia)/<span class="keyword">sizeof</span>(*ia);</span><br><span class="line"><span class="keyword">int</span> arr2[sz];</span><br></pre></td></tr></table></figure>

<h2 id="4-10-Comma-Operator"><a href="#4-10-Comma-Operator" class="headerlink" title="4.10 Comma Operator"></a>4.10 Comma Operator</h2><p>The comma operator takes two operands, which it evaluates frmo left to rigtht.</p>
<h2 id="4-11-Type-Conversions"><a href="#4-11-Type-Conversions" class="headerlink" title="4.11 Type Conversions"></a>4.11 Type Conversions</h2><p><strong>Implicit conversions</strong>: Some conversions are carried out automatically without programmer intervention–and sometimes without programmer knowledge. </p>
<p>Conwerting a <code>double</code> to an <code>int</code> truncates the <code>double</code>‘s value, discarding the decimal portin.</p>
<p><strong>When Implicit Conversions Occur</strong></p>
<ul>
<li>In arithmetic and relational expressions with operands of mixed types, the types are converted to a common type;</li>
<li>Conversions also happen during function calls;</li>
</ul>
<h3 id="4-11-1-The-Arithmetic-Conversions"><a href="#4-11-1-The-Arithmetic-Conversions" class="headerlink" title="4.11.1 The Arithmetic Conversions"></a>4.11.1 The Arithmetic Conversions</h3><p>Nothing much, never mind.</p>
<h3 id="4-11-2-Other-Implicit-Conversions"><a href="#4-11-2-Other-Implicit-Conversions" class="headerlink" title="4.11.2 Other Implicit Conversions"></a>4.11.2 Other Implicit Conversions</h3><p><strong>Array to Pointer Conversions</strong>: In most expressions, when we use an array, the array is automatically converted to a pointer.</p>
<p><strong>Pointer Conversions</strong>: There are several other pointer conversions.</p>
<h3 id="4-11-3-显式转换"><a href="#4-11-3-显式转换" class="headerlink" title="4.11.3 显式转换"></a>4.11.3 显式转换</h3><p>(I’m so fucking tired of taking English notes, English should be my helper not the obstacle)</p>
<p><strong>NOTES</strong> 虽然有时不得不使用强制类型转换，但是这种方法本质上是十分危险的。</p>
<p>强制类型转换有如下形式：</p>
<p><em>cast-name<type>(expression);</type></em></p>
<p><em>cast-name</em> 是<code>static_cast</code>，<code>dynamic_cast</code>，<code>const_cast</code>和<code>reinterpret_cast</code>中的 一种。</p>
<p><code>static_cast</code>：任何具有明确定义的类型转换，只要不包含底层<code>const</code>，都可以用<code>static_cast</code>。</p>
<p><code>const_cast</code>：只能改变运算对象的底层<code>const</code>，即去<code>const</code>性质。常用于有函数重载的上下文中。</p>
<p><code>reinterpret_cast</code>：通常为运算对象的位模式提供较低层次上的重新解释。</p>
<p><strong>WARNING</strong> 与命名的强制类型转换相比，旧式的强制类型转换从表现形式上来说不那么清晰明了，容易被看漏，所以一旦转换过程出现问题，追踪起来也更加困难。</p>

          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/26/CPP-Primer-Chapter-1-Getting-Started/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zepyhrus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/08/26/CPP-Primer-Chapter-1-Getting-Started/" class="post-title-link" itemprop="url">CPP Primer: Chapter 1 Getting Started</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-08-26 11:17:26 / Modified: 11:29:22" itemprop="dateCreated datePublished" datetime="2019-08-26T11:17:26+08:00">2019-08-26</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="Cpp-Primer-Notes"><a href="#Cpp-Primer-Notes" class="headerlink" title="Cpp Primer Notes"></a>Cpp Primer Notes</h1><p>This a implementation of some of the exercises from the book: C++ Primer. And also some notes from the book. The github source could be found <a href="https://github.com/Zepyhrus/CPP-Primer" target="_blank" rel="noopener">here</a>.</p>
<h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><p>Ubuntu 18.04 LTS<br>gcc/g++: 5.5<br>vscode: 1.35.0, x64</p>
<h2 id="Chapter-1-Getting-Started"><a href="#Chapter-1-Getting-Started" class="headerlink" title="Chapter 1 Getting Started"></a>Chapter 1 Getting Started</h2><h2 id="1-4-Flow-of-control"><a href="#1-4-Flow-of-control" class="headerlink" title="1.4 Flow of control"></a>1.4 Flow of control</h2><h3 id="1-4-1-The-While-statement"><a href="#1-4-1-The-While-statement" class="headerlink" title="1.4.1 The While statement"></a>1.4.1 The <em>While</em> statement</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> b = ++a;  <span class="comment">// a + 1 before assigned to b, cal after a + 1;</span></span><br><span class="line"><span class="keyword">int</span> c = a++;  <span class="comment">// a + 1 after assigned to c, cal before a + 1;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-4-3-Reading-an-Unknown-Number-of-INputs"><a href="#1-4-3-Reading-an-Unknown-Number-of-INputs" class="headerlink" title="1.4.3 Reading an Unknown Number of INputs"></a>1.4.3 Reading an Unknown Number of INputs</h3><ul>
<li>The end of input is CTRL + d;</li>
<li>It is a good practice to recompile the code after each fix – or after making at most a small number of obvious fixes. This is called <em>edit-compile-debug</em>.</li>
<li>exercise at input_if.cc</li>
</ul>
<h2 id="1-5-Introducing-Classes"><a href="#1-5-Introducing-Classes" class="headerlink" title="1.5 Introducing Classes"></a>1.5 Introducing Classes</h2><ol>
<li>Memeber function: a function that is defined as part of a class, sometimes referred to as <strong>methods</strong>;</li>
<li><code>()</code>: the <code>call</code> operator;</li>
</ol>
<ul>
<li>Uninitialized variables are a rich source of bugs;</li>
</ul>

          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/26/CPP-Primer-Chapter-3-String-Vectors-and-Arrays/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zepyhrus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/08/26/CPP-Primer-Chapter-3-String-Vectors-and-Arrays/" class="post-title-link" itemprop="url">CPP Primer: Chapter 3 String, Vectors, and Arrays</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-08-26 11:11:53" itemprop="dateCreated datePublished" datetime="2019-08-26T11:11:53+08:00">2019-08-26</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-08-27 09:07:41" itemprop="dateModified" datetime="2019-08-27T09:07:41+08:00">2019-08-27</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="Strings-Vectors-And-Arrays"><a href="#Strings-Vectors-And-Arrays" class="headerlink" title="Strings, Vectors, And Arrays"></a>Strings, Vectors, And Arrays</h1><p>The standard library defines a number of additiaonal types of a higher-level nature that computer hardware usually does not implement directly.</p>
<h2 id="3-1-Namespace-using-Declarations"><a href="#3-1-Namespace-using-Declarations" class="headerlink" title="3.1 Namespace using Declarations"></a>3.1 Namespace using Declarations</h2><p><strong>Headers Should Not Include <code>using</code> Declarations</strong>: The contents of a header are copied into the including program’s text. If a header has a <code>using</code> declaration, then it will pollute all scope with such <code>using</code> statement.</p>
<h2 id="3-2-Library-string"><a href="#3-2-Library-string" class="headerlink" title="3.2 Library string"></a>3.2 Library <code>string</code></h2><h3 id="3-2-1-Defining-and-Initializeing-strings"><a href="#3-2-1-Defining-and-Initializeing-strings" class="headerlink" title="3.2.1 Defining and Initializeing strings"></a>3.2.1 Defining and Initializeing <code>strings</code></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">s4</span><span class="params">(<span class="number">10</span>, <span class="string">'c'</span>)</span></span>; <span class="comment">//  s4 is cccccccccc</span></span><br></pre></td></tr></table></figure>

<p><strong>Direct and Copy Forms of Initialization</strong>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> s5 = <span class="string">"hiya"</span>; <span class="comment">//  copy initialization</span></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">s6</span><span class="params">(<span class="string">"hiya"</span>)</span></span>;  <span class="comment">//  direct initialization</span></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">s7</span><span class="params">(<span class="number">10</span>, <span class="string">'c'</span>)</span></span>; <span class="comment">//  direct initialization</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-Operations-on-strings"><a href="#3-2-2-Operations-on-strings" class="headerlink" title="3.2.2 Operations on strings"></a>3.2.2 Operations on <code>string</code>s</h4><p><strong>Table: String Operations</strong>: On page. 86.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">getline(is, s); <span class="comment">//  Reads a line of input from is into s, returns is.</span></span><br><span class="line">s.empty();      <span class="comment">//</span></span><br><span class="line">s.size();       <span class="comment">//  Returns the number of characters in s</span></span><br><span class="line">s[n];           <span class="comment">//  returns a reference to the char at position n in s.</span></span><br><span class="line">s1 + s2;        <span class="comment">//</span></span><br><span class="line">s1 = s2;        <span class="comment">//</span></span><br><span class="line">s1 == s2;       <span class="comment">//</span></span><br><span class="line">&lt;, &lt;=, &gt;, &gt;=;   <span class="comment">//  Comparisions are case-sensitive and use dictionary ordering</span></span><br></pre></td></tr></table></figure>

<p><strong>Using <code>getline</code> to Read an Entire Line</strong>: if you want to take the input and keep the whitespace in input:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">string</span> line;</span><br><span class="line">  <span class="keyword">while</span> (getline(<span class="built_in">cin</span>, line))</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; line &lt;&lt; <span class="built_in">endl</span>; <span class="comment">//  we need endl to end the current line and flush the buffer</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>The string::size_type Type</strong>: <code>string::size_type</code> returns a size_type value. If n ins an int that holds a negative value, then s.size() &lt; n will almost surely evaluate as true. It yields true because the negative value in n will convert to a large unsigned value.</p>
<p><strong>Adding Literals and strings</strong>: When we mix strings and string or character literals, at least one operand to each + operator must be of string type.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> s5 = <span class="string">"hello"</span> + <span class="string">", "</span>;   <span class="comment">//  error: no string operand</span></span><br><span class="line"><span class="built_in">string</span> s7 = <span class="string">"hello"</span> + <span class="string">", "</span> + s2;    <span class="comment">//  error: can't add string literals</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-3-Dealing-with-the-Characters-in-a-string"><a href="#3-2-3-Dealing-with-the-Characters-in-a-string" class="headerlink" title="3.2.3 Dealing with the Characters in a string"></a>3.2.3 Dealing with the Characters in a string</h3><p><strong>Advice</strong>: Use the C++ version of C Library Headers. Headers in C have names of the form name.h. The C++ version of these headers are named cname–they remove the .h suffix and precede the name with the letterc. The c indicates that the header is part of the C library.<br><code>cctype</code> has the same contents as <code>ctype.h</code>, but in a form that is approprate for C++ programs. In particular, the names defined in the <code>cname</code> headers are defined inside the <code>std</code> namespace, whereas those defined in the .h versions are not.</p>
<p><strong>Note</strong>:</p>
<ul>
<li><code>string.h</code> contains old functions like <code>strcpy</code>, <code>strlen</code> for C style null-terminated strings, use <code>cstring</code> instead.</li>
<li><code>string</code> primarily contains the <code>std::string</code>, <code>std::wstring</code> and other classes.</li>
</ul>
<p><strong>Use Range-Based for to process every Character</strong>: Introduced in C++ 11, while the <code>expression</code> should represent a sequence.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (declaration : expression)</span><br><span class="line">  statement</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">str</span><span class="params">(<span class="string">"some string"</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fprint the characters in str one character to a line</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> c : str)</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; c &lt;&lt; <span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure>

<p>Example code:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">s</span><span class="params">(<span class="string">"Hello world!!!"</span>)</span></span>;</span><br><span class="line"><span class="comment">// punct_cunt has the same type that s.size returns;</span></span><br><span class="line"><span class="keyword">decltype</span>(s.size()) punct_cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// count the number of punctutation characters in s</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> c : s)</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">ispunct</span>(c))</span><br><span class="line">    ++punct_cnt;</span><br><span class="line"></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; punct_cnt</span><br><span class="line">  &lt;&lt; <span class="string">" punctiuation characters in "</span> &lt;&lt; s &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;c :s)</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">isalpha</span>(c))</span><br><span class="line">    c = <span class="built_in">toupper</span>(c);</span><br><span class="line"></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; s &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="comment">/* cctype Functions</span></span><br><span class="line"><span class="comment">  * isalnum(c): true if c is a letter or a digit</span></span><br><span class="line"><span class="comment">  * isalpha(c): true if c is a letter</span></span><br><span class="line"><span class="comment">  * iscntrl(c): true if c is a control character</span></span><br><span class="line"><span class="comment">  * isdigit(c): true if c is a digit</span></span><br><span class="line"><span class="comment">  * isgraph(c): true if c is not a space but is printable</span></span><br><span class="line"><span class="comment">  * islower(c): true if c is a lowercase letter</span></span><br><span class="line"><span class="comment">  * isprint(c): true if c is a printable character (i.e., a space or a character that has a visible representation)</span></span><br><span class="line"><span class="comment">  * ispunct(c): true if c is a punctutation charcter</span></span><br><span class="line"><span class="comment">  * isspace(c): true if c is a space</span></span><br><span class="line"><span class="comment">  * isupper(c): true if c is an uppercase letter</span></span><br><span class="line"><span class="comment">  * isxdigit(c): true if c is a hexadecimal digit</span></span><br><span class="line"><span class="comment">  * tolower(c): convert c to its lowercase equivalent if c is a letter</span></span><br><span class="line"><span class="comment">  * toupper(c): convert c to its uppercase equivalent if c is a letter</span></span><br><span class="line"><span class="comment">  */</span></span><br></pre></td></tr></table></figure>

<p><strong>Process Only Some Characters</strong>: We can use a subscript or an iterator. Note that the subscript will be converted to unsigned int.</p>
<p><strong>Using a Subscript for Random Access</strong>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">string</span> hexdigits = <span class="string">"0123456789ABCDEF"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"Enter a series of numbers between 0 and 15"</span></span><br><span class="line">      &lt;&lt; <span class="string">" separated by spaces. Hit ENDTER when finished: "</span></span><br><span class="line">      &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> result;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span>::size_type n;</span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">cin</span> &gt;&gt; n)</span><br><span class="line">  <span class="keyword">if</span> (n &lt; hexdigits.size())</span><br><span class="line">    result += hexdigits[n];</span><br><span class="line"></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"Your hex number is: "</span> &lt;&lt; result &lt;&lt; <span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure>

<h2 id="3-3-Library-vector-Type"><a href="#3-3-Library-vector-Type" class="headerlink" title="3.3 Library vector Type"></a>3.3 Library vector Type</h2><p>A vector is a class template. C++ has both class and function templates.The process that the compiler uses to create classees or functions from templates is called <strong>Instantiation</strong>.<br><strong>Note</strong>: vector is a template, not a type. Types generated from vector must include the element type, for example, <code>vector&lt;int&gt;</code>. Some compilers may require the old-style declarations for a vector of vectors, for example, <code>vector&lt;vector&lt;int&gt; &gt;</code>.</p>
<h3 id="3-3-1-Deifining-and-Initializing-vectors"><a href="#3-3-1-Deifining-and-Initializing-vectors" class="headerlink" title="3.3.1 Deifining and Initializing vectors"></a>3.3.1 Deifining and Initializing vectors</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;T&gt; v1;                   <span class="comment">//  vector that holds objects of type T. Default initialization; v1 is empty</span></span><br><span class="line"><span class="built_in">vector</span>&lt;T&gt; v2(v1);               <span class="comment">//  v2 has a copy of each element in v1.</span></span><br><span class="line"><span class="built_in">vector</span>&lt;T&gt; v2 = v1;              <span class="comment">//  Equivalent to v2(v1)</span></span><br><span class="line"><span class="built_in">vector</span>&lt;T&gt; v3(n, val);           <span class="comment">//  v3 has n elements with value val.</span></span><br><span class="line"><span class="built_in">vector</span>&lt;T&gt; v4(n);                <span class="comment">//  v4 has n copipes of a value-initialized object</span></span><br><span class="line"><span class="built_in">vector</span>&lt;T&gt; v5&#123;a, b, c, ...&#125;;     <span class="comment">//  v5 has as manay elements as there are initializers; elements are initialized by corresponding initializers</span></span><br><span class="line"><span class="built_in">vector</span>&lt;T&gt; v5 = &#123;a, b, c, ...&#125;;  <span class="comment">//  Equivalent to v5&#123;a, b, c, ...&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Key Concept</strong>: vectors grow efficiently: If differing element values are needed, it is usually more efficient to define an empty vector and add elements as the values we need become known at run time. Moreover, vector offers capabilityes to allow us to further enhance run-time performance when we add elements. Deifne a vector of a specific size could result in poorer performance.</p>
<p><strong>Warning</strong>: The body of a range <code>for</code> must not change the size of the sequence over which it is iterating.</p>
<h3 id="3-3-2-Other-vector-Operations"><a href="#3-3-2-Other-vector-Operations" class="headerlink" title="3.3.2 Other vector Operations"></a>3.3.2 Other vector Operations</h3><p><strong>Warning</strong>: <em>buffer overflow</em> errors are the result of subscripting elements that don`t exst. Such bugs are the most common cause of security problems in PC and other applications.</p>
<h2 id="3-4-Introducing-Iterators"><a href="#3-4-Introducing-Iterators" class="headerlink" title="3.4 Introducing Iterators"></a>3.4 Introducing Iterators</h2><p>All of the library containers have iterators, but only a few of them support the subscript operator. <code>string</code> is not a container, but it supports most of the container operations, <code>string</code> also supports iterators.</p>
<h3 id="3-4-1-Using-Iterators"><a href="#3-4-1-Using-Iterators" class="headerlink" title="3.4.1 Using Iterators"></a>3.4.1 Using Iterators</h3><p>The iterator returned by end is often referred to as the off-the-end iterator or abbreviated as “the <code>end</code> iterator”.</p>
<p><strong>Iterator Operations</strong>: Iterator only supports a few operations.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*iter;          <span class="comment">// Returns a reference to the element denoted by the iterator iter.</span></span><br><span class="line">iter-&gt;mem;      <span class="comment">// Dereferences iter and fetches the member named mem from the underlying element, Equivalent to (*iter).mem</span></span><br><span class="line">++iter;         <span class="comment">// Increments iter to refer to the next element in the container</span></span><br><span class="line">--iter;         <span class="comment">// Decrements iter to refer to the previous element in the container</span></span><br><span class="line">iter1 == iter2; <span class="comment">//Compares two iterators for equaility. Two iterators are equal if they denote the same element or if they are the off-the-end iterator for the same container</span></span><br></pre></td></tr></table></figure>

<p><strong>MMoving Iterators from One Element to Another</strong>: Because the iterator returned from end does not denote an element, it may not be incremented or dereferenced.</p>
<p><strong>Key Concept: Generic Programming</strong>: Only a few containers have the subscript operator. Most of thoes iterators do not have the &lt; operator. So C++ programmers use <code>!=</code> operator in the loop instead of <code>&lt;</code> operator.</p>
<p><strong>The <code>begin</code> and <code>end</code> Operations</strong>: The default behavior is often not we want, return <code>iterator</code> for vector and <code>const_iterator</code> for const vector, while we usually want <code>const</code> type to read but not to write. It is suggested to use following new functions in new standard.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> it3 = v.cbegin();</span><br></pre></td></tr></table></figure>

<h3 id="3-4-2-Iterator-Arithmetic"><a href="#3-4-2-Iterator-Arithmetic" class="headerlink" title="3.4.2 Iterator Arithmetic"></a>3.4.2 Iterator Arithmetic</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iter + n;         <span class="comment">//</span></span><br><span class="line">iter - n;</span><br><span class="line">iter1 += n;</span><br><span class="line">iter1 -= n;</span><br><span class="line">iter1 - iter2;    <span class="comment">// Substracting 2 iterators yiels the number that when added to the right-hande iterator yelds the left-head iterator.</span></span><br><span class="line"></span><br><span class="line">&gt;, &gt;=, &lt;, &lt;=;     <span class="comment">// One iterator is less than another if it refers to an element that appears in the container before the one referred to by the other iterator.</span></span><br></pre></td></tr></table></figure>

<p><strong>Arithmetic Operations on Iterators</strong>: Compute an iterator te the element nearest the middle of a <code>vector</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> mid = vi.begin() + vi.size() / <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p><strong>Using Iterator Arithmetic</strong>: A classic algorithm that uses iterator arithmetic is binary search.</p>
<h2 id="3-5-Arrays"><a href="#3-5-Arrays" class="headerlink" title="3.5 Arrays"></a>3.5 Arrays</h2><p>An array is a data structure that is similar to the library <code>vector</code> type but offers a different trade-off between performance and flexibility.</p>
<p>An array is a <strong>compound type</strong>, which is defined based on other type, like reference and pointer.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> cnt = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">unsigned</span> sz = <span class="number">42</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> arr[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">int</span> *parr[sz];</span><br><span class="line"><span class="built_in">string</span> bad[cnt];</span><br><span class="line"><span class="built_in">string</span> strs[get_size()];</span><br></pre></td></tr></table></figure>

<p>By default, the elements in an array are default initialized. Arrays hold objects, thus , there are no arrays of references.</p>
<p><strong>Explicitly Initializing Array Elements</strong>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> sz = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">int</span> ia1[sz] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> a2[] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> a3[<span class="number">5</span>] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;;    <span class="comment">// equivalent ot a3[] = &#123;0, 1, 2, 0, 0&#125;</span></span><br><span class="line"><span class="built_in">string</span> a4[<span class="number">3</span>] = &#123;<span class="string">"hi"</span>, <span class="string">"bye"</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> a5[<span class="number">2</span>] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;;    <span class="comment">// error: too many arguments</span></span><br></pre></td></tr></table></figure>

<p><strong>Character Arrays Are Special</strong>: String literals end with a null character. That null character is copied into the array along with the characters in the literal.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> a1[] = &#123;<span class="string">'C'</span>, <span class="string">'+'</span>, <span class="string">'+'</span>&#125;;</span><br><span class="line"><span class="keyword">char</span> a2[] = &#123;<span class="string">'C'</span>, <span class="string">'+'</span>, <span class="string">'+'</span>, <span class="string">'\0'</span>&#125;;    <span class="comment">// list initialization, explicit null</span></span><br><span class="line"><span class="keyword">char</span> a3[] = <span class="string">"C++"</span>;                    <span class="comment">// null termintator added automatically</span></span><br><span class="line"><span class="keyword">char</span> a4[<span class="number">6</span>] = <span class="string">"Daniel"</span>;                <span class="comment">// error: nospace for the null</span></span><br></pre></td></tr></table></figure>

<p><strong>No Copi or Assignment</strong>: We cannot initialize an array as a copi of another array, nor is it legal to assign one array to another.</p>
<p><strong>Complicated Array Declarations</strong>: Read the declaration from inside out and then right to left.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> *ptrs[<span class="number">10</span>];                    <span class="comment">// ptrs is an array of ten pointers to int</span></span><br><span class="line"><span class="keyword">int</span> &amp;refs[<span class="number">10</span>] = <span class="comment">/* ? */</span>;          <span class="comment">// error: no arrays of references</span></span><br><span class="line"><span class="keyword">int</span> (*Parray) [<span class="number">10</span>] = &amp;arr;        <span class="comment">// Parray points to an array of ten ints</span></span><br><span class="line"><span class="keyword">int</span> (&amp;arrRef)[<span class="number">10</span>] = arr;          <span class="comment">// arrRef refers to an array of ten ints</span></span><br><span class="line"><span class="keyword">int</span> *(&amp;arry)[<span class="number">10</span>] = ptrs;          <span class="comment">// arry arry is a reference to an array of ten pointers</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-2-Accessing-the-Elements-of-an-Array"><a href="#3-5-2-Accessing-the-Elements-of-an-Array" class="headerlink" title="3.5.2 Accessing the Elements of an Array"></a>3.5.2 Accessing the Elements of an Array</h3><p>Nothing much, you should be able to accesss elements in arrays like in vectors.</p>
<h3 id="3-5-3-Pointers-and-Arrays"><a href="#3-5-3-Pointers-and-Arrays" class="headerlink" title="3.5.3 Pointers and Arrays"></a>3.5.3 Pointers and Arrays</h3><p>In C++, when we use an array, the compiler ordinarily converts the array to a pointer. The arrays have a special property–in most places when we use an array, the compiler automatically substitutes a poiter to the first elemet:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> nums[] = &#123;<span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> *p = &amp;nums[<span class="number">0</span>];     <span class="comment">// p points the first element in nums</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> *p2 = nums;        <span class="comment">// equivalent to p2 = &amp;nums[0]</span></span><br></pre></td></tr></table></figure>

<p><strong>Pointers Are Iterators</strong>: In particular, pointers to array elements support the same operations as iterators on <code>vector</code> or <code>string</code>.</p>
<p><strong>The Libarary <code>begin</code> and <code>end</code> Functions</strong>: <code>begin</code> returns a pointer to the first, and <code>end</code> returns a pointer one past the last element in the given array. These funcgtions are defined in the <code>iterator</code> header.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ia[] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> *beg = begin(ia);</span><br><span class="line"><span class="keyword">int</span> *last = end(ia);</span><br></pre></td></tr></table></figure>

<p><strong>Pointer Arithmetic</strong>: Pointers acn use all the iterator operations.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constexpr</span> <span class="keyword">size_t</span> sz = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> arr[sz] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> *ip = arr;                    <span class="comment">// equivalent to int *ip = &amp;arr[0]</span></span><br><span class="line"><span class="keyword">int</span> *ip2 = ip + <span class="number">4</span>;                <span class="comment">// ip2 points to arr[4], the last element in arr</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ok: arr is converted to a pointer to its first element; p points one past the end of arr</span></span><br><span class="line"><span class="keyword">int</span> *p = arr + sz;                <span class="comment">// do not dereference</span></span><br><span class="line"><span class="keyword">int</span> *p2 = arr + <span class="number">10</span>;               <span class="comment">// error: arr has only 5 elements; p2 has undefined value</span></span><br></pre></td></tr></table></figure>

<p>The result of substracting two pointers is a library type named <code>ptrdiff_t</code>. Like <code>size_t</code>, the <code>ptrdiff_t</code> type is a machine-specific type and is defined in the <code>cstddef</code> header.</p>
<p><strong>Interaction between Dereference and Pointer Arithmetic</strong>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ia[] = &#123;<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> last = *(ia + <span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p><strong>Subscripts and Pointers</strong>: In most places when we use the name of an array, we are really using a pointer to the first element in that array. We can use the subscript operator on any pointer, as long as that pointer points to an element (or one past the last element) in an array.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> *p = &amp;ia[<span class="number">2</span>];      <span class="comment">// p points to the element indexed by 2</span></span><br><span class="line"><span class="keyword">int</span> j = p[<span class="number">1</span>];         <span class="comment">// p[1] is the same element as ia[3]</span></span><br><span class="line"><span class="keyword">int</span> k = p[<span class="number">-2</span>];        <span class="comment">// p[-2] is the same element as ia[0]</span></span><br></pre></td></tr></table></figure>

<p><strong>Warning</strong>: Unlike subscripts for <code>vector</code> and <code>string</code>, the index of the built-in subscript operator is not an <code>unsigned</code> type.</p>
<h3 id="3-5-4-C-Style-Character-Strings"><a href="#3-5-4-C-Style-Character-Strings" class="headerlink" title="3.5.4 C-Style Character Strings"></a>3.5.4 C-Style Character Strings</h3><p><strong>C Library String Functions</strong>: Included in <code>cstring</code> header file.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">strlen</span>(p);        <span class="comment">// Renturns the length of p, not cunting the null</span></span><br><span class="line"><span class="built_in">strcmp</span>(p1, p2);   <span class="comment">// Compares p1 and p2 for equality. Returns 0 if p1 == p2, a positive value if p1 &gt; p2, a negative value if p1 &lt; p2</span></span><br><span class="line"><span class="built_in">strcat</span>(p1, p2);   <span class="comment">// Appends p2 to p1. Returns p1.</span></span><br><span class="line"><span class="built_in">strcpy</span>(p1, p2);   <span class="comment">// Copies p2 into p1. Returns p1.</span></span><br></pre></td></tr></table></figure>

<p><strong>Notes</strong>: Remember that when we are comparing arraies, we are really using a pointer to the first element in the array.</p>
<p><strong>Caller Is Responsible for Size of a Destination String</strong>: For most applications, in addition to being safer, it is also more efficient to use library strings rather than C-style strings.</p>
<h3 id="3-5-5-INterfacing-to-Older-Code"><a href="#3-5-5-INterfacing-to-Older-Code" class="headerlink" title="3.5.5 INterfacing to Older Code"></a>3.5.5 INterfacing to Older Code</h3><p>The <code>string</code> member funciton named <code>c_str</code> that we can often use to accomplish what we want.</p>
<p><strong>Using an Array to Initialize a <code>vector</code></strong>: We cannot initialize a built-in array from another array. But we can, and we only can initialize a <code>vector</code> using an array.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> int_arr[] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ivec(begin(int_arr), end(int_arr));</span><br><span class="line"></span><br><span class="line"><span class="comment">/* create a sub vector */</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; sub_vec(int_arr + <span class="number">1</span>, int_arr + <span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<h2 id="3-6-Multidimensional-Arrays"><a href="#3-6-Multidimensional-Arrays" class="headerlink" title="3.6 Multidimensional Arrays"></a>3.6 Multidimensional Arrays</h2><p><strong>Using a Ranf for with Multidimensional Arrays</strong>: The range for loop could be done under the new standard.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">size_t</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;row : ia)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;col : row)&#123;</span><br><span class="line">    col = cnt;</span><br><span class="line">    ++cnt;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>Notes</strong>: To use a multidimensional array in a range for, the loop control variable for all but the innermost array must be references.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> *ip[<span class="number">4</span>];     <span class="comment">// array of pointers to int</span></span><br><span class="line"><span class="keyword">int</span> (*ip)[<span class="number">4</span>];   <span class="comment">// pointer to an array of four ints</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// print the value of each element in ia, with each inner array on its own line</span></span><br><span class="line"><span class="comment">// p points to an array of four ints</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> p = ia; p != ia + <span class="number">3</span>; ++p) &#123;</span><br><span class="line">  <span class="comment">// q points to the first element of an array of four ints; that is , q points to an int</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> q = *p; q != *p + <span class="number">4</span>; ++q)</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *q &lt;&lt; <span class="string">'\t'</span>;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Defined-Terms"><a href="#Defined-Terms" class="headerlink" title="Defined Terms"></a>Defined Terms</h2><ul>
<li>begin/end: included in <code>&lt;iterator&gt;</code>, return the pointers to an array`s begin and end;</li>
<li>buffer overflow: When we use an index that is out-of-range for a container;</li>
<li>difference_type: A <code>signed</code> integral type defined by <code>vector</code> and <code>string</code> that can hold the distance between any two iterators;</li>
<li>ptrdiff_t/size_t: Machine-dependent signed integral type defined in the <code>cstddef</code> header that is large enough to held the difference between 2 pointers into the largest possible array;</li>
</ul>

          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/26/Opencv-Matrix-Operations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zepyhrus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/08/26/Opencv-Matrix-Operations/" class="post-title-link" itemprop="url">Opencv Matrix Operations</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-08-26 10:23:14" itemprop="dateCreated datePublished" datetime="2019-08-26T10:23:14+08:00">2019-08-26</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-08-27 10:28:25" itemprop="dateModified" datetime="2019-08-27T10:28:25+08:00">2019-08-27</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="OpenCV-Matrix-Operations"><a href="#OpenCV-Matrix-Operations" class="headerlink" title="OpenCV Matrix Operations"></a>OpenCV Matrix Operations</h1><p>Since OpenCV is the most widely used image processing library, the matrix operation and basic linear algebra is inevidable.</p>
<h2 id="1-Initialization"><a href="#1-Initialization" class="headerlink" title="1. Initialization"></a>1. Initialization</h2><p>Remeber that you have to initialize a Mat from a array.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/core/core.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addMatrixExample</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">float</span> a[<span class="number">2</span>][<span class="number">2</span>] = &#123;&#123;<span class="number">1</span>, <span class="number">2</span>&#125;,</span><br><span class="line">                   &#123;<span class="number">3</span>, <span class="number">4</span>&#125;&#125;;</span><br><span class="line">  <span class="keyword">float</span> b[<span class="number">2</span>][<span class="number">2</span>] = &#123;&#123;<span class="number">5</span>, <span class="number">6</span>&#125;,</span><br><span class="line">                   &#123;<span class="number">7</span>, <span class="number">8</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">  Mat A = Mat(<span class="number">2</span>, <span class="number">2</span>, CV_32FC1, a);</span><br><span class="line">  Mat B = Mat(<span class="number">2</span>, <span class="number">2</span>, CV_32FC1, b);</span><br><span class="line">  Mat C;</span><br><span class="line">  C = A + B;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"C ="</span> &lt;&lt; <span class="built_in">endl</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; C &lt;&lt; <span class="built_in">endl</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    addMatrixExample();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-Point"><a href="#2-Point" class="headerlink" title="2. Point"></a>2. Point</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> Point_&lt;<span class="keyword">int</span>&gt; Point2i;</span><br><span class="line"><span class="keyword">typedef</span> Point2i Point;</span><br><span class="line"><span class="keyword">typedef</span> Point_&lt;<span class="keyword">float</span>&gt; Point2f;</span><br><span class="line"><span class="keyword">typedef</span> Point_&lt;<span class="keyword">double</span>&gt; Point2d;</span><br><span class="line"><span class="keyword">typedef</span> Point3_&lt;<span class="keyword">int</span>&gt; Point3i;</span><br><span class="line"><span class="keyword">typedef</span> Point3_&lt;<span class="keyword">float</span>&gt; Point3f;</span><br><span class="line"><span class="keyword">typedef</span> Point3_&lt;<span class="keyword">double</span>&gt; Point3d;</span><br></pre></td></tr></table></figure>

<p>From the above we can see that <code>Point</code>, <code>Point2i</code>, <code>Point_&lt;int&gt;</code> are exactly the same.</p>

          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zepyhrus</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
  </nav>



        </div>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zepyhrus</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.3.0</div>

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>


  <script src="/js/schemes/muse.js?v=7.3.0"></script>



<script src="/js/next-boot.js?v=7.3.0"></script>




  




























  

  

  


  
</body>
</html>
